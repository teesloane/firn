<html><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,400;0,500;1,400&amp;display=swap" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/prism.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/firn_base.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/basscss.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/customization.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/img/favico.png" rel="icon" type="image/png" /><title>Firn - The Ice Shelf</title><script src="https://firn.theiceshelf.com/static/js/prism.js"></script></head><body><nav class="nav"><div class="nav-container"><div class="nav-left"><div id="nav-icon" onClick="toggleMenu()"><span></span><span></span><span></span><span></span></div><img class="nav-logo" src="https://firn.theiceshelf.com/static/img/ico-light.png" width="32" /></div><div class="nav-links"><a class="nav-links-item" href="https://firn.theiceshelf.com/"><span>Home</span></a><a class="nav-links-item" href="https://firn.theiceshelf.com/getting-started"><span>Docs</span></a><a class="nav-links-item" href="https://github.com/theiceshelf/firn"><span>Github</span></a></div></div></nav><main class="def-wrapper"><aside class="def-sidebar unfocused" id="sidebar"><ul class="firn-sitemap firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/index">Home</a></li><li class="firn-sitemap-item--child"><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/getting-started">Getting Started</a><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/tutorial">Step by Step Tutorial</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/setup">Firn Setup (with Emacs)</a></li></ul></li><li class="firn-sitemap-item--child"><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/content">Content</a><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/front-matter">Front Matter</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/layout">Layouts and Partials</a></li><li class="firn-sitemap-item--child"><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/the-render-function">The Render Function</a><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/files-and-headlines">Files And Headlines</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/folding">Folding</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/sitemap">Sitemap</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/adjacent-files">Adjacent Files</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/backlinks_and_related_files">Backlinks and Related Files</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/org_tags">Org Tags</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/firn_tags">Firn Tags</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/table-of-contents">Table Of Contents</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/logbooks">Logbooks</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/breadcrumbs">Breadcrumbs</a></li></ul></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/pages">Custom Pages</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/styling">Styling</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/data-and-metadata">Data and Metadata</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/static-assets">Static Assets / Attachments</a></li></ul></li><li class="firn-sitemap-item--child"><div class="firn-sitemap-item--no-link">Reference</div><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/configuration">Configuration</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/limitations">Limitations</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/sample-page">Sample Page</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/changelog">Changelog</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/repl">Repl</a></li></ul></li></ul></aside><article class="def-content-wrap"><div class="def-content"><h1 class="mb0">Layouts and Partials</h1><div class="flex h6 mb1"><div class="pr1">Last updated: </div><div class="italic">2020-11-04 20:12</div></div><div><section></section><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="overview"><span class="firn-headline-text"><span>Overview</span></span></h1><section><p><span>When you create a new Firn site for the first time, it will create a folder:</span><code>_firn/layouts</code><span>. The layout folder stores Clojure files (</span><code>.clj</code><span>) that are
responsible for how your org-file is rendered to-html; The act of "applying" a
template means to pass the content of the org-file through a specific </span><a class="firn-external" href="https://github.com/weavejester/hiccup" target="_blank">clojure hiccup</a><span>
template that organizes how the content is displayed.</span></p><p><span>When an org-mode file is processed by Firn it looks for the in-buffer-setting (or what might be called "</span><a class="firn-internal" href="https://firn.theiceshelf.com/front-matter">Front Matter</a><span>")</span><code>#+FIRN_LAYOUT:</code><span> to see if it uses a Layout. If none are specified, the </span><u><span>default
template</span></u><span> is used.</span></p></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="a-simple-layout-file"><span class="firn-headline-text"><span>A simple layout file</span></span></h1><section><p><span>Let's consider a simple layout file:</span></p><pre class="language-clojure"><code class="language-clojure">
(defn default                   ; define a clojure func
  [{:keys [build-url title render partials]}] ; destructured commonly used functions and data
  (let [{:keys [head]} partials]              ; Ignore for now, partials will be explained later
    [:html                      ; => opens a `html` tag
     (head build-url)           ; => Renders the `head` partial
     [:body                     ; => opens a `body` tag
      [:main                    ; => Ditto
       [:article.def-wrapper    ; => opens a `article` html tag with a class of `def-wrapper`
        [:div.def-content       ; => see above
         [:h1 title]            ; => renders an `h1` tag with the file title.
         (render :file) ;       ; => `render` is where the magic happens!
         ]]]]]))                ; => all these closing brackets can be thought of as closing html tags (for now)
</code></pre><p><span>The above may look a little strange if you are not familiar with Clojure. The
next document will expand on what the </span><code>render</code><span> function does.</span></p><p><span>Your layout files </span><strong><span>can have several functions</span></strong><span> in them, but the </span><strong><span>last function in the
file</span></strong><span> is the one that is loaded as your layout.</span></p></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="partials"><span class="firn-headline-text"><span>Partials</span></span></h1><section><p><span>In the example above you may have noticed the </span><code>partials</code><span> binding appear. Partials
are similar to layouts: they are clojure functions that render html. Partials
are used for rendering particularly common pieces of html that might be shared
across several layouts (such as the </span><code>head</code><span> of your HTML document as in the example
above).</span></p><p><span>Using partials requires the following:</span></p><ol><li><p><span>Create a partial in the </span><code>partials</code><span> directory.</span></p><ul><li><p><span>A partial must be a clojure function, just the same as a layout file.</span></p></li><li><p><span>The </span><strong><span>last function</span></strong><span> in your partial file </span><em><span>is the partial that is applied</span></em><span>.</span></p></li></ul></li><li><p><code>partials</code><span> are a map of all the partial functions and is passed into layouts
   when they are rendered:</span></p><pre class="language-clojure"><code class="language-clojure">    (defn default
      [{:keys [partials]}] ; `partials` is a a map.
</code></pre></li><li><p><span>You can optionally bind the partials you need in a let block so that they are
   easily callable as functions. The name of your partial is the name of the
   partial file. For example, the docs you are reading has a </span><code>partials/head.clj</code><span> file, and is accessible like so:</span></p><pre class="language-clojure"><code class="language-clojure">    (defn default                   ; define a clojure func
      [{:keys [partials]}]          ; destructure the `partials` key.
      (let [{:keys [head]} partials]
          [:html                      ; => opens a `html` tag
          (head build-url)            ; => Renders the `head` partial
          ; ....
</code></pre></li></ol></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="the-user-layout-map"><span class="firn-headline-text"><span>The user layout map</span></span><span class="firn-org-tags"><span><a class="firn-org-tag" href="/tags#advanced">advanced</a></span></span></h1><section><p><span>The following is a description of the map that gets passed to all user layouts. As such, all of these keys may be destructured as mentioned above. Some values may be removed / added.</span></p><pre class="language-clojure"><code class="language-clojure">{;; Layout stuff --
 :render        (partial render {:file file :config config})
 :partials      (config :partials)
 ;; Site-side stuff --
 :site-map      (config :site-map)
 :site-links    (config :site-links)
 :site-logs     (config :site-logs)
 :site-title    (cfg/prop config :site-title)
 :site-author   (cfg/prop config :site-author)
 :site-desc     (cfg/prop config :site-desc)
 :site-url      site-url
 :org-tags      (config :org-tags)
 :firn-tags     (config :firn-tags)
 :build-url     (build-url site-url)
 :config        config
 ;; File wide meta --
 :file          file
 :meta          (file :meta)
 :logbook       (-> file :meta :logbook)
 :file-links    (-> file :meta :links)      ;; TODO - possible re/move this too?
 :title         (-> file :meta :title)
 :firn-under    (-> file :meta :firn-under) ;; TODO this should be removed; should be handled by the render function...?
 :logbook-total (-> file :meta :logbook-total)
 :date-updated  (-> file :meta :date-updated)
 :date-created  (-> file :meta :date-created)}
</code></pre></section></div></div><div class="adjacent-files"><span><div class="firn-file-navigation"><span class="firn-file-nav-prev">Previous: <a href="https://firn.theiceshelf.com/front-matter">Front Matter</a></span> <span class="firn-file-nav-next">Next: <a href="https://firn.theiceshelf.com/the-render-function">The Render Function</a></span></div></span></div><footer><script src="/static/js/main.js"></script></footer></div></article><aside class="def-toc unfocused" id="toc"><div><h4>Contents</h4><div><ol><li><a href="#overview">Overview</a></li><li><a href="#a-simple-layout-file">A simple layout file</a></li><li><a href="#partials">Partials</a></li><li><a href="#the-user-layout-map">The user layout map</a></li></ol></div></div><div><h4>Backlinks</h4><ul class="firn-backlinks"><li class="firn-backlink"><a href="https://firn.theiceshelf.com/folding">Folding</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/firn_tags">Firn Tags</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/table-of-contents">Table Of Contents</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/tutorial">Step by Step Tutorial</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/repl">Repl</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/content">Content</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/pages">Custom Pages</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/files-and-headlines">Files And Headlines</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/data-and-metadata">Data and Metadata</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/backlinks_and_related_files">Backlinks and Related Files</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/sitemap">Sitemap</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/configuration">Configuration</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/breadcrumbs">Breadcrumbs</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/logbooks">Logbooks</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/adjacent-files">Adjacent Files</a></li><li class="firn-backlink"><a href="https://firn.theiceshelf.com/index">Home</a></li></ul></div></aside></main></body></html>